name: Joke Updater

on:
  schedule:
    - cron: '0 0 * * *' # Runs every day at 00:00
  workflow_dispatch:  # Allows manual triggering

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Install dependencies
        run: sudo apt-get install -y jq

      - uses: actions/checkout@v2

      - name: Fetch joke
        id: fetch_joke
        run: |
          JOKE_RESPONSE=$(curl -s https://v2.jokeapi.dev/joke/Programming)
          JOKE_TYPE=$(echo $JOKE_RESPONSE | jq -r '.type')

          if [ "$JOKE_TYPE" == "single" ]
          then
          JOKE=$(echo $JOKE_RESPONSE | jq -r '.joke')
          else
          SETUP=$(echo $JOKE_RESPONSE | jq -r '.setup')
          DELIVERY=$(echo $JOKE_RESPONSE | jq -r '.delivery')
          JOKE="$SETUP - $DELIVERY"
fi

echo "JOKE=$JOKE" >> $GITHUB_ENV


      - name: Update README
        run: |
          sed -i "/<!--joke-start-->/,/<!--joke-end-->/c\<!--joke-start-->\nJOKE_PLACEHOLDER\n<!--joke-end-->" README.md
          sed -i "s|JOKE_PLACEHOLDER|${{ env.JOKE }}|g" README.md

      - name: Commit and push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git commit -m "Updated Joke"
          git push
